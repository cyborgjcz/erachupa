;디버그용 일괄 설정 함수
@DEBUG_G
#FUNCTION
#DIM DYNAMIC LCOUNT
GIANT_BATTLE = 1
FOR LCOUNT,0,8
    GIGANT_DAMAGE:LCOUNT += LCOUNT * 100000
NEXT
GIGANT_DAMAGE:0 += 100000
RETURNF 1

;화면 흔들림 함수
@SHAKE_SCREEN(KEYV=1)
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC LCOUNT2
#DIM DYNAMIC KEYV
SIF !SHAKE_SCREEN_OK
    RETURN 0
FOR LCOUNT,0,(RAND:2+2)
    FOR LCOUNT2,0,KEYV
        PRINTL
    NEXT
    TWAIT 5,1
    CLEARLINE KEYV
    REUSELASTLINE
    TWAIT 2,1
NEXT

@SHOW_GIANT_BATTLE_INFO(KEYV)
#DIM DYNAMIC KEYV
PRINT_SPACE 4000

;3D 지도 출력 화면 상에서 정보 표시 함수
@SHOW_GIANT_DAMAGE_INFO(KEYV)
#DIM DYNAMIC KEYV;0 TO 23
#DIM DYNAMIC NUMTOSHOWV
;원본 일러스트 작자 = sworc https://www.ac-illust.com/main/profile.php?id=Iq24yifd&area=1
SELECTCASE KEYV
    CASE 0
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚ
        RESETCOLOR
    CASE 1
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_머리)
        PRINT ￕￋￗ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚￚￚￚￚￚ
        RESETCOLOR
    CASE 2
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_머리)
        PRINT ￅￇￇￇￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_등짝)
        PRINT ￋￋￋￗ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚ
        RESETCOLOR
    CASE 3
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￗ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_머리)
        PRINT ￋￅￇￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￅￋￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￅￋﾨ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        RESETCOLOR
    CASE 4
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￊ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￅﾰﾧￇￅￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￇￇￋￇￇￋ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        RESETCOLOR
    CASE 5
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￖￗￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￅￗￕￇￋￇￇ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￇￇￇￋￅￋￅ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚ
        RESETCOLOR
    CASE 6
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￇￅￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￇￇￋￇￇￇￋￇￋￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￇￅￋￅￋￗ
        SETCOLORBYNAME DimGray
        PRINT ￚ
        RESETCOLOR
    CASE 7
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￋￕￇￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ﾢￅﾨￅￅￅￅￇￋﾧ
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￎￇￇￋￅﾯ
        RESETCOLOR
    CASE 8
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￗￅￇￇￇￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￗ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￅￅￋￋ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ﾨￋￅￋￗ
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￗￅￅￇￕ
        RESETCOLOR
    CASE 9
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￛￇￋￅﾧ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￋￛￅ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_몸통)
        PRINT ￋￇￇￋ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ﾲￅￇￇￅ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￋￋￇ
        RESETCOLOR
    CASE 10
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￋￇￅﾧￆﾧ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￋￇￇￋￋￋￅￇￋￊ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_왼팔)
        PRINT ￎﾧￗￇ
        RESETCOLOR
    CASE 11
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_오른팔)
        PRINT ￛￇￗ
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￍￅￇￇￗﾨ
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￇￋￅￅￇￋ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚ
        RESETCOLOR
    CASE 12
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￕￇￇﾧ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￇￅￅￅￅﾧ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        RESETCOLOR
    CASE 13
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￆￅￇￇￇￗ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￇￇￋￋ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        RESETCOLOR
    CASE 14
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ﾡￋￇￋￋￅￗ
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￇￅￋￅￇﾤ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        RESETCOLOR
    CASE 15
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￋￇￋￋﾧ
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￅￋￋￅ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        RESETCOLOR
    CASE 16
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ﾡￗￗￅￇￋﾤ
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￕￊￗￗￋￗ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        RESETCOLOR
    CASE 17
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￊￅￇￋﾧ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￅￊￕￅ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        RESETCOLOR
    CASE 18
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￋￅￅￋￋￅ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￇￅￋￅￇￋ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚ
        RESETCOLOR
    CASE 19
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￗￕￋￅￋￋￕ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￅￋￅￅ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚ
        RESETCOLOR
    CASE 20
        SETCOLORBYNAME DimGray
        PRINT ￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￗￅￅￅￅￋￋￅￋ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￛￋￋￅￅￅￋ
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        RESETCOLOR
    CASE 21
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￅￕￋￗￅￅￇￋￎ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￇￇￋￗￕￋￅￇﾤ
        RESETCOLOR
    CASE 22
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￛﾻￛￛ
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￋￇￅￅￇￋￅￅￅ
        RESETCOLOR
    CASE 23
        SETCOLORBYNAME DimGray
        PRINT ￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ﾻﾩﾩ
        SETCOLORBYNAME DimGray
        PRINT ￚￚ
        CALL SET_GIGANT_DAMAGE_COLOR(GIGANT_다리)
        PRINT ￇￇￇ
        RESETCOLOR
ENDSELECT

[SKIPSTART]
;표기 숫자가 천만이 넘지 않게끔 줄이는 함수
@NUMBER_TEN_MILLION_CAP(NUMV)
#FUNCTION
#DIM DYNAMIC NUMV
SIF NUMV >= 10000000
    NUMV = 9999999
RETURNF NUMV
[SKIPEND]

;부위 번호를 받아서 해당 부위의 플로트 UI 컬러를 어떻게 표시할지 판가름하는 함수
;양호하다면 녹색을, 대미지를 받으면 붉은 색으로
@SET_GIGANT_DAMAGE_COLOR(KEYV)
#DIM DYNAMIC KEYV
#DIM DYNAMIC DAMCAPV
#DIM DYNAMIC HPV
#DIM DYNAMIC DAMAGEV
SELECTCASE KEYV
    CASE 0 TO 7
        {
            DAMCAPV = GET_GIGANT_PART_BASE_STAT(STOCK_PARTD:(CURRENT_GIGANT:KEYV),GIGANT_내구임계) +
            MOD_DATA:(CURRENT_GIGANT:KEYV):GIGANT_내구임계
        }
        {
            HPV = GET_GIGANT_PART_BASE_STAT(CURRENT_GIGANT:KEYV,GIGANT_내구) +
            MOD_DATA:(CURRENT_GIGANT:KEYV):GIGANT_내구
        }
        DAMAGEV = GIGANT_DAMAGE:KEYV
    CASE 8
        DAMCAPV = GET_GIGANT_TOTAL_STAT(GIGANT_내구임계)
        HPV = GET_GIGANT_TOTAL_STAT(GIGANT_내구)
        DAMAGEV = GET_GIGANT_TOTAL_DAMAGE()
    CASEELSE
        DEBUGPRINTFORML SET_GIGANT_DAMAGE_COLOR 함수의 인수({KEYV})가 올바르지 않습니다
        RETURN 0
ENDSELECT
SELECTCASE DAMAGEV
    CASE 0 TO DAMCAPV / 4
        ;내구임계의 4분의 1까지
        SETCOLORBYNAME Green
    CASE (DAMCAPV / 4) + 1 TO (DAMCAPV / 2)
        ;내구임계의 2분의 1까지
        SETCOLORBYNAME Yellow
    CASE (DAMCAPV / 2) + 1 TO (DAMCAPV / 4) * 3
        ;내구임계의 3/4까지
        SETCOLORBYNAME Orange
    CASE ((DAMCAPV / 4) * 3) + 1 TO DAMCAPV
        ;내구임계 직전까지
        SETCOLORBYNAME OrangeRed
    CASE DAMCAPV TO HPV
        ;내구임계 돌파
        SETCOLORBYNAME Red
    CASEELSE
        ;내구치 이상
        SETCOLORBYNAME DarkRed
ENDSELECT
RETURN 1

;통상시 미니맵을 표시한 화면에 거대보스전 정보를 표시하는 함수
@SHOW_GIANT_BATTLE_SIDE_INFO(KEYV)
#DIM DYNAMIC KEYV
;부위별 대미지 현황을 표시한 다음 오른쪽에 다른 정보를 표시한다
CALL SHOW_GIANT_DAMAGE_INFO(KEYV)
SELECTCASE KEYV
    ;나침반 영역
    CASE 0 TO 2
        CALL D3D_SHOW_COMPASS(KEYV)
        SETCOLORBYNAME OrangeRed
        ;"ALERT" AA 표시
        SELECTCASE KEYV
            CASE 0
                PRINT_SPACE 380
                PRINT __ __ __
            CASE 1
                PRINT  /⧵
                PRINT_SPACE 20
                PRINT |
                PRINT_SPACE 95
                PRINT |_ |_) |
            CASE 2
                PRINT /-⧵|__|_
                PRINT_SPACE 25
                PRINT | ⧵
                PRINT_SPACE 55
                PRINT |
        ENDSELECT
        RESETCOLOR
    ;지도 표시 영역
    CASE 3 TO 11
        CALL SHOW_GIANT_BATTLE_MAP(KEYV - 3)
    CASE 13
        PRINT 내구도 : 
        CALL GIGANT_HP_COLORBAR
    CASE 14
        PRINT 안정도 : 
        PRINT 대충 컬러바
    CASE 15
        PRINT 동력계 : 
        PRINT 대충 정상
    CASE 17
        PRINT 무장 : 
        PRINT 핫찌미
ENDSELECT

;거대로봇 전투 용 회전하는 4칸 반경 미니맵
@SHOW_GIANT_BATTLE_MAP(KEYV)
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC KEYV
#DIM DYNAMIC T_X,9
#DIM DYNAMIC T_Y,9
;방향에 따라 표시할 내용 전환
SELECTCASE D3D_PLAYER_DIRECTION
    CASE 0
        FOR LCOUNT,0,9
            T_X:LCOUNT = D3D_PLAYER_XCOORD + (LCOUNT - 4)
            T_Y:LCOUNT = D3D_PLAYER_YCOORD + (KEYV - 4)
        NEXT
    CASE 1
        FOR LCOUNT,0,9
            T_X:LCOUNT = D3D_PLAYER_XCOORD - (KEYV - 4)
            T_Y:LCOUNT = D3D_PLAYER_YCOORD - 4 + LCOUNT
        NEXT
    CASE 2
        FOR LCOUNT,0,9
            T_X:LCOUNT = D3D_PLAYER_XCOORD - (LCOUNT - 4)
            T_Y:LCOUNT = D3D_PLAYER_YCOORD - (KEYV - 4)
        NEXT
    CASE 3
        FOR LCOUNT,0,9
            T_X:LCOUNT = D3D_PLAYER_XCOORD + (KEYV - 4)
            T_Y:LCOUNT = D3D_PLAYER_YCOORD + 4 - LCOUNT
        NEXT
ENDSELECT
;실제로 미니맵 출력
FOR LCOUNT,0,9
    ;맵 밖이라면 공백 출력
    IF T_X:LCOUNT < 0 || T_Y:LCOUNT < 0 || T_X:LCOUNT > 18 || T_Y:LCOUNT > 18
        PRINT 　
    ;맵 밖이 아니면 D3D_MINIMAPS에서 가져옴
    ELSE
        SETCOLOR D3D_MINIMAPS_C:(T_X:LCOUNT):(T_Y:LCOUNT)
        SELECTCASE D3D_MINIMAPS:(T_X:LCOUNT):(T_Y:LCOUNT)
            ;플레이어 타일 수정
            CASE "⏶","⏵","⏷","⏴"
                PRINT ⏶
            ;기본 출력
            CASEELSE
                PRINTS D3D_MINIMAPS:(T_X:LCOUNT):(T_Y:LCOUNT)
        ENDSELECT
        ;정렬 수정
        SELECTCASE D3D_MINIMAPS:(T_X:LCOUNT):(T_Y:LCOUNT)
            CASE "⏶","⏵","⏷","⏴"
                PRINT_SPACE 21
            CASE "□","■"
                PRINT_SPACE 10
        ENDSELECT
    ENDIF
NEXT
RESETCOLOR

@GIGANT_HP_COLORBAR
CALL SET_GIGANT_DAMAGE_COLOR(8)
GETCOLOR
{
    CALL PRINT_COLORBAR(GET_GIGANT_TOTAL_STAT(GIGANT_내구) - GET_GIGANT_TOTAL_DAMAGE(),
    GET_GIGANT_TOTAL_STAT(GIGANT_내구),96,
    UNICODE(0x258F), UNICODE(0x258F), RESULT, 0x626262)
}
RESETCOLOR