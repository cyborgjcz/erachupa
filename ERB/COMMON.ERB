;-----------------------------------------------------------
;등록번호로부터 CSV 번호 반환하는 식중함수
;-----------------------------------------------------------
@GET_ID(KEY)
#FUNCTION
#DIM DYNAMIC KEY

RETURNF NO:KEY

;등록번호로부터 동료를 반환하는 식중함수
@PARTNER(KEY)
#FUNCTION
#DIM DYNAMIC KEY
IF CFLAG:KEY:동료
    RETURNF FLAG:((CFLAG:KEY:동료)^3)
ELSE
    DEBUGPRINTFORML 동료로 설정되지 않은 캐릭터({KEY}, %CALLNAME:KEY%)의 PARTNER를 확인하려 시도했습니다
    RETURNF 0
ENDIF

;등록번호로부터 동료 별명을 반환하는 식중함수
@BUDDY(KEY)
#FUNCTIONS
#DIM DYNAMIC KEY
IF CFLAG:KEY:동료
    RETURNF BYNAMES(KEY,PARTNER(KEY))
ELSE
    DEBUGPRINTFORML 동료로 설정되지 않은 캐릭터({KEY}, %CALLNAME:KEY%)의 파트너의 별명을 확인하려 시도했습니다
    RETURNF 0
ENDIF

;등록번호로부터 동료의 주인공번호를 반환하는 식중함수
@BUDDYWHERE(KEY)
#FUNCTION
#DIM DYNAMIC KEY
IF CFLAG:KEY:동료
    RETURNF CFLAG:PARTNER(KEY):동료
ELSE
    DEBUGPRINTFORML 동료로 설정되지 않은 캐릭터({KEY}, %CALLNAME:KEY%)의 파트너의 주인공 번호를 확인하려 시도했습니다
    RETURNF 0
ENDIF

@ISHERO(KEY)
#FUNCTION
#DIM DYNAMIC KEY
IF KEY == FLAG:1 || KEY == FLAG:2
    RETURNF 1
ELSE
    RETURNF 0
ENDIF

;전투불능 확인
@ISDYING(KEY)
#FUNCTION
#DIM DYNAMIC KEY
RETURNF CFLAG:KEY:상태이상 & 1

;상태이상 중인지 체크. KEY2는 bit 비교를 위한 값.
@ISBASUTE(KEY,KEY2)
#FUNCTION
#DIM DYNAMIC KEY
#DIM DYNAMIC KEY2
;KEY2 2=독 3=출혈 4=공포 5=격앙
IF CFLAG:KEY:상태이상 & (POWER(2,KEY2-1))
    RETURNF 1
ELSE
    RETURNF 0
ENDIF

@MIXELLIPSIS(VALUES,MIXS="...",KEYV=2)
#FUNCTIONS
#DIM DYNAMIC LOOPCOUNT
#DIMS DYNAMIC VALUES;원본문자열
#DIMS DYNAMIC MIXS;섞을 문자열. 기본은 말줄임표(...)
#DIM DYNAMIC KEYV;빈도,많을수록 드물게
#DIM DYNAMIC ELLIPSISNUM;갯수 체크
#DIMS DYNAMIC FINALSTRINGS

DO
    ;최종 문자열 초기화
    FINALSTRINGS '= ""
    LOOPCOUNT = 0
    DO
        CHARATU VALUES,LOOPCOUNT
        ;CHARATU 결과가 빈 문자열이라면 문자열 끝이므로 반복 중단
        SIF RESULTS:0 == ""
            BREAK
        FINALSTRINGS += RESULTS:0
        IF RESULTS:0 != " "
            IF RAND:KEYV == 0
                FINALSTRINGS += MIXS
                ELLIPSISNUM += 1
            ENDIF
        ENDIF
        LOOPCOUNT += 1
    LOOP 1
    ;단 한번도 MIXS를 추가하여 문자열을 만들지 않았다면 다시.
    SIF ELLIPSISNUM > 0
        BREAK
LOOP 1
RETURNF FINALSTRINGS

;입력받은 문자열의 첫 문자의 종성을 제거하고 반환. 
;ex) 중생이라는 값을 받으면 주 를 반환한다
@STUTTERKR(VALUES)
#FUNCTIONS
#DIMS DYNAMIC VALUES
#DIM DYNAMIC TCODE;타겟코드
#DIM DYNAMIC JONG;종성

CHARATU VALUES, 0
ENCODETOUNI %RESULTS%
TCODE = RESULT:1
JONG = ((TCODE - 44032) % 588)%28
RETURNF UNICODE(TCODE - JONG) + ", " + VALUES

;TRYCCALLFORM ~CATCH 및 오류 메시지 디버그출력만 하는 함수
;코드를 보기 편하게 만들기 위한 목적
@KOJO_CATCH(VALUES)
#DIMS DYNAMIC VALUES
TRYCCALLFORM %VALUES%
CATCH
    DEBUGPRINTFORML 구상 오류 %VALUES% 호출실패
ENDCATCH