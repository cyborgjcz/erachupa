;공의 목적지를 설정하는 함수
@SET_BALL(TARGETX,TARGETY,HOWV,BALL)
#DIM DYNAMIC TARGETX
#DIM DYNAMIC TARGETY
#DIM DYNAMIC HOWV
#DIM REF BALL,0,0

;NEXT 항에 예정 정보들을 대입한다
;이동 방식
BALL:OY_STATUS_NEXT:0 = HOWV
BALL:OY_TARGET_NEXT:0 = TARGETX,TARGETY
SELECTCASE BALL:OY_TARGET:0
    CASE IS < BALL:OY_TARGET:0
        BALL:OY_DIRECTION_NEXT:0 = OY_RIGHT
    CASE IS > BALL:OY_TARGET:0
        BALL:OY_DIRECTION_NEXT:0 = OY_LEFT
ENDSELECT

;공의 실제 이동
@MOVE_BALL(BALL)
#DIM REF BALL,0,0
#DIM DYNAMIC GRAVITYV

IF BALL:OY_TIME:0 >= BALL:OY_DURATION:0
    ;목표 도착 설정
    BALL:OY_COORD:0 = BALL:OY_TARGET:0
    BALL:OY_COORD:1 = BALL:OY_TARGET:1
    ;움직이는 상태 갱신
    BALL:OY_STATUS:0 = BALL:OY_STATUS_NEXT:0
    ;예정된 상태값의 초기화
    BALL:OY_STATUS_NEXT:0 = 0
    ;목표 좌표 갱신
    BALL:OY_TARGET:0 = BALL:OY_TARGET_NEXT:0
    BALL:OY_TARGET:1 = BALL:OY_TARGET_NEXT:1
    ;예정된 목표 좌표 초기화
    BALL:OY_TARGET_NEXT:0 = 0
    BALL:OY_TARGET_NEXT:1 = 0
    ;목표 방향 갱신
    BALL:OY_DIRECTION:0 = BALL:OY_DIRECTION_NEXT:0
    ;0이 되어 부정의 값이 된 경우 0일 수는 없으므로 새로 설정
    IF !BALL:OY_DIRECTION:0
        SELECTCASE BALL:OY_COORD:0
            CASE IS < BALL:OY_TARGET:0
                BALL:OY_DIRECTION:0 = OY_RIGHT
            CASE IS > BALL:OY_TARGET:0
                BALL:OY_DIRECTION:0 = OY_LEFT
        ENDSELECT
    ENDIF
    ;초기화
    BALL:OY_DIRECTION_NEXT:0 = 0
    BALL:OY_TIME:0 = 0
    BALL:OY_DURATION:0 = ABS(BALL:OY_TARGET:0 - BALL:OY_COORD:0)
    ;거리에 따른 속도 설정
    SELECTCASE BALL:OY_DURATION:0
        CASE IS > 999
            BALL:OY_HIGH:0 = 1
            BALL:OY_SPEED:0 = 20
            BALL:OY_DURATION:0 /= 20
        CASE 750 TO 999
            BALL:OY_HIGH:0 = 3
            BALL:OY_SPEED:0 = 16
            BALL:OY_DURATION:0 /= 16
        CASE 500 TO 749
            BALL:OY_HIGH:0 = 5
            BALL:OY_SPEED:0 = 10
            BALL:OY_DURATION:0 /= 10
        CASE 250 TO 499
            BALL:OY_HIGH:0 = 6
            BALL:OY_SPEED:0 = 8
            BALL:OY_DURATION:0 /= 8
        CASE 0 TO 249
            BALL:OY_HIGH:0 = 7
            BALL:OY_SPEED:0 = 2
            BALL:OY_DURATION:0 /= 2
    ENDSELECT
ENDIF
BALL:OY_TIME:0 ++
;볼의 좌표를 실제로 변화시키는 차례
BALL:OY_COORD:0 += BALL:OY_DIRECTION:0 * BALL:OY_SPEED:0
SELECTCASE BALL:OY_STATUS:0
    CASE 0
    CASE 1
        ;포물선 운동
        CALL SET_GRAV_QUADRA(GRAVITYV,BALL:OY_TIME:0,BALL:OY_DURATION:0,BALL)
        BALL:OY_COORD:1 += GRAVITYV
    CASE 2
    CASE 3
ENDSELECT

;공이 매번 움직이는 장면에서 중력값 변경
@SET_GRAV_QUADRA(GRAVITYV,TIMEV,DURAV,BALL)
#DIM REF GRAVITYV;변화시키는 중력
#DIM REF BALL,0,0
#DIM DYNAMIC TIMEV;전달받은 현재진행시간
#DIM DYNAMIC DURAV;진행해야하는 총 시간

#DIM DYNAMIC GRAVITYA,100
#DIM DYNAMIC STARTV
#DIM DYNAMIC KEYV
#DIM DYNAMIC MULTIV
REPEAT 100
    GRAVITYA:COUNT = SQRT(2500-POWER(COUNT-50,2))-40
REND
SELECTCASE DURAV-TIMEV
    CASE IS < (DURAV/2)+1
        ;절반 이하 진행
        STARTV = 0
        MULTIV = 1
    CASE IS >= (DURAV/2)+1
        ;절반 이상 진행
        STARTV = 50
        MULTIV = -1
ENDSELECT

GRAVITYV = GRAVITYA:(STARTV + (TIMEV * 50 / DURAV))

;중력 배수
SELECTCASE BALL:OY_HIGH:0
    CASE 10
        TIMES GRAVITYV,2.00
    CASE 9
        TIMES GRAVITYV,1.80
    CASE 8
        TIMES GRAVITYV,1.60
    CASE 7
        TIMES GRAVITYV,1.40
    CASE 6
        TIMES GRAVITYV,1.20
    CASE 5
        TIMES GRAVITYV,1.00
    CASE 4
        TIMES GRAVITYV,0.80
    CASE 3
        TIMES GRAVITYV,0.60
    CASE 2
        TIMES GRAVITYV,0.40
    CASE 1
        TIMES GRAVITYV,0.20
    CASE 0
        TIMES GRAVITYV,0.10
ENDSELECT
GRAVITYV *= MULTIV