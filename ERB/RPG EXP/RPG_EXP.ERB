;레벨업 함수. ;반환값은 레벨업한 횟수이다. 
;이것은 함수 호출 후 출력 텍스트 및 능력 상승 등에 반영한다
@LEVELUP(KEYV)
#DIM DYNAMIC KEYV
#DIM DYNAMIC LSWITCH
#DIM DYNAMIC PASTLV
LSWITCH = 1
PASTLV = BASE:KEYV:레벨
DO
    IF CHECK_RPG_LVUP(KEYV)
        RPG_EXP:KEYV:0 -= NEXT_RPG_EXP(KEYV)
        BASE:KEYV:레벨 += 1
    ELSE 
        LSWITCH = 0
    ENDIF
LOOP LSWITCH
SIF PASTLV < BASE:KEYV:레벨
    RETURN BASE:KEYV:레벨 - PASTLV
RETURN 0

;다음 레벨까지 경험치와 현재 경험치를 대조해 레벨업 여부 판정
@CHECK_RPG_LVUP(KEYV)
#FUNCTION
#DIM DYNAMIC KEYV

SIF RPG_EXP:KEYV:0 >= NEXT_RPG_EXP(KEYV)
    RETURNF 1
RETURNF 0

;경험치 0을 보유하고 있을 때 다음 레벨까지 필요한 경험치를 반환
;즉, NEXT EXP라고 예쁘게 표시할 때는 RPG_EXP 값을 빼줘야한다.
@NEXT_RPG_EXP(KEYV)
#FUNCTION
#DIM DYNAMIC KEYV
#DIM DYNAMIC NEXTLV
#DIM DYNAMIC NEXTEXP
NEXTLV = BASE:KEYV:레벨 + 1

RETURNF (POWER(2 * NEXTLV,3) + POWER(9 * NEXTLV,2) + (61 * NEXTLV))/6

;등록번호, 레벨업 횟수를 인수로 받아 스탯 상승 처리
@RPG_STATUP(KEYV,NUMV)
#DIM DYNAMIC KEYV
#DIM DYNAMIC NUMV
#DIM DYNAMIC LOOPV


[SKIPSTART]
LOOPV = 1

DO
;HERE
LOOP LOOPV
[SKIPEND]