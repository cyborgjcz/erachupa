@DUNGEON2_INIT
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC LCOUNT2
#DIMS DYNAMIC MAPDATAS,19

MAPDATAS: 0 '= "0000000000000000000"
MAPDATAS: 1 '= "0310401121011^^^^^0"
MAPDATAS: 2 '= "0312111001114555550"
MAPDATAS: 3 '= "0310101100000111110"
MAPDATAS: 4 '= "0500100121110114110"
MAPDATAS: 5 '= "011[110101110100010"
MAPDATAS: 6 '= "00100101011121040[0"
MAPDATAS: 7 '= "011511^400000001110"
MAPDATAS: 8 '= "0110100003111111000"
MAPDATAS: 9 '= "011514031000100001>"
MAPDATAS:10 '= "01^0^0^010111110110"
MAPDATAS:11 '= "0111111110100010110"
MAPDATAS:12 '= "0050505010110110140"
MAPDATAS:13 '= "0111111010010100200"
MAPDATAS:14 '= "0200001010411111110"
MAPDATAS:15 '= "0111101[10002001410"
MAPDATAS:16 '= "0041100000011101110"
MAPDATAS:17 '= "0011121111513100000"
MAPDATAS:18 '= "000)00000)000000000"


FOR LCOUNT2,0,19
    FOR LCOUNT,0,19
        IF SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1) == " "
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = -1
        ELSEIF SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1) == "["
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = 32
        ELSEIF SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1) == "*"
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = 34
        ELSEIF SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1) == "^"
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = 24
        ELSEIF SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1) == ")"
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = 29
        ELSEIF SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1) == ">"
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = 19
        ELSE
            D3D_TOTAL_MAPDATA:2:LCOUNT:LCOUNT2 = TOINT(SUBSTRING(MAPDATAS:LCOUNT2,LCOUNT,1))
        ENDIF
    NEXT
NEXT

@PLAY_DUNGEON2_BGM
#DIMS DYNAMIC BGMS = "d1.mp3"
SIF EXISTSOUND(BGMS)
    PLAYBGM BGMS
BGM_BEFORE_BATTLE = %BGMS%

@DUNGEON2_ENCOUNTER_SET
{
    IF (DUNGEON_IN_FIELD(1,6,13,17) && !DUNGEON_IN_FIELD(6,6,17,17)) ||
    (DUNGEON_IN_FIELD(9,17,3,6) && !DUNGEON_IN_FIELD(15,15,6,6))
}
    ;두 안전지대
    RETURN 0,0,1
ELSE
    ;디버깅용 전역안전지대 처리 필요
    RETURN 1,7;,1
ENDIF

@DUNGEON2_RAND_ENCOUNTER(XCOORD,YCOORD)
#DIM DYNAMIC XCOORD
#DIM DYNAMIC YCOORD
#DIM DYNAMIC LNUM

TFLAG:적무리번호 = 0
TFLAG:적위치2 = 100
TFLAG:적레벨2 = 1
TFLAG:배틀BGM번호 = 1

@DUNGEON2_EVENT(XCOORD,YCOORD)
#DIM DYNAMIC XCOORD
#DIM DYNAMIC YCOORD

IF XCOORD == 9 && YCOORD == 18
    ;이전 층으로 이동하는 제1경로
    RETURN 9,1,1,1
ELSEIF XCOORD == 3 && YCOORD == 18
    ;이전 층으로 이동하는 제2경로
    RETURN 3,1,1,1
ENDIF